<!--<%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%>-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<script src="http://code.responsivevoice.org/responsivevoice.js"></script>
	
	<script>

	var responsiveVoiceParams = {
		onend: voiceEndCallback,
		volume: 1,
		rate: 1,
		
	};

	function sayText(text){
		var voice = $("#voicesDropdown").val();
		responsiveVoice.speak(text, voice, responsiveVoiceParams);
	}
	
	function voiceEndCallback(){
		$("#textQueue li:first").remove();
		sayNextTextBlock();
	}
	
	function sayNextTextBlock(){
		if (!responsiveVoice.isPlaying()){
			var $nextInQueue = $("#textQueue li:first");
			if ($nextInQueue.length > 0){
				var text = $nextInQueue.text();
				sayText(text);
			}
		}
	}

	function textboxSubmit(){
		var $textInput = $("#textInput");
		var text = $textInput.val();
		if (text != ""){
			var $textQueue = $("#textQueue");
			$textQueue.append($("<li/>").text(text));
			$textInput.val("");
			sayNextTextBlock();
		}
	}
	
	$(function(){
		$("#textInput").keypress(function(e){
			if(e.keyCode == 13)
				textboxSubmit();
		});
		
		$("#playButton").click(function(){
			textboxSubmit();
		});

// Cant do this- I have to pass in a voice to the speak command or the stupid thing cries		
//		$("#voicesDropdown").change(function(){
//			responsiveVoice.setDefaultVoice($("#voicesDropdown").val());
//		});
		
		var voiceOptions = responsiveVoice.getVoices();
		var $voicesDropdown = $("#voicesDropdown");
		for(var i = 0; i < voiceOptions.length; ++i){
			var voice = voiceOptions[i].name;
			$voicesDropdown.append($("<option />").val(voice).text(voice));
		}
	});
	</script>
	
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
		<title>Talker Thingy</title>
	</head>
	
	<body>
		<select id="voicesDropdown" name="voicesDropdown"></select>
		<br /><br />
		<ul id="textQueue"></ul>
		<br /><br />
		<input id="textInput" name="textInput" type="text" value="Fuck this noise"/>
		<input id="playButton" name="playButton" type="button" value="Play"/>
	</body>
	
</html>